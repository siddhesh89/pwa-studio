<!DOCTYPE html>
<html lang="" dir="ltr">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<title>Client-side caching | Magento PWA Documentation</title>
	<meta name="description" content="Everything you need to build a Magento PWA.">

	<link rel="stylesheet" href="/pwa-studio/assets/css/app.css?ver=7" />
	<link rel="stylesheet" href="/pwa-studio/assets/css/print.css?ver=7" media="print"/>

	<link rel="stylesheet" href="/pwa-studio/builds/css/main.css" />

<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

	<script>
  var baseUrl = "/pwa-studio";
  var algolia = {
    id : "E642SEDTHL",
    index: "pwa-devdocs",
    key: "d2d0f33ab73e291ef8d88d8b565e754c"
  };

  var indices = [
    {
      label: "PWA",
      name: "pwa-devdocs",
      baseUrl: "https://pwastudio.io"
    },
    {
      label: "DevDocs",
      name: "devdocs",
      facets: [["guide_version: 2.3", "versionless: true"]],
      refinements: [
        {
          label: "Functional areas",
          attribute: "functional_areas"
        }
      ],
      baseUrl: "https://devdocs.magento.com"
    },
    {
      label: "User Guide",
      name: "merchdocs_ee",
      baseUrl: "https://docs.magento.com/m2/ee/user_guide"
    },
    {
      label: "MBI User Guide",
      name: "merchdocs-mbi",
      baseUrl: "https://docs.magento.com/mbi"
    },
    {
      label: "Order Management",
      name: "oms-en",
      baseUrl: "https://omsdocs.magento.com"
    }
  ];
</script>



<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-KRCLXBB');</script>
<!-- End Google Tag Manager -->




	<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="https://magento.com/favicon.ico">
	<link rel="apple-touch-icon" type="image/png" href="https://magento.com/apple-touch-icon.png">
	<link rel="apple-touch-icon" type="image/png" sizes="57x57" href="https://magento.com/apple-touch-icon-57x57.png">
	<link rel="apple-touch-icon" type="image/png" sizes="72x72" href="https://magento.com/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="https://magento.com/apple-touch-icon-76x76.png">
	<link rel="apple-touch-icon" type="image/png" sizes="114x114" href="https://magento.com/apple-touch-icon-114x114.png">
	<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="https://magento.com/apple-touch-icon-120x120.png">
	<link rel="apple-touch-icon" type="image/png" sizes="144x144" href="https://magento.com/apple-touch-icon-144x144.png">
	<link rel="apple-touch-icon" type="image/png" sizes="152x152" href="https://magento.com/apple-touch-icon-152x152.png">
	<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="https://magento.com/apple-touch-icon-180x180.png">

</head>
<body class="layout-default">


	<header class="site-header">
		<nav class="site-nav">

  <div class="nav-container">

    <div class="menu-btn">
      <button id="menu-btn" class="menu-trigger menu-icon" aria-haspopup="true" aria-controls="nav-main" aria-label="Menu"></button>
    </div>

    <a class="logo" data-proofer-ignore href="/pwa-studio/">
      <img src="/pwa-studio/assets/i/m-logo.svg" alt="">
      <img src="/pwa-studio/assets/i/magento-logo.svg" alt="Magento" class="magento-logo" />
      <span class="site-logo">PWA Docs</span>
    </a>

    <div id="nav-main" class="nav-main-wrap" aria-labelledby="menu-btn">
      

      <!-- Main Navigation -->
<ul class="nav-main" role="menubar">

  
  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span href="#" data-proofer-ignore tabindex="-1">Getting Started</span>
    <div class="nav-popup">
      <ul>
        
        <li role="menuitem">
          <a href="/pwa-studio/technologies/overview/">Overview</a>
        </li> 
        
        <li role="menuitem">
          <a href="/pwa-studio/technologies/storefront-architecture/">Storefront architecture</a>
        </li> 
        
        <li role="menuitem">
          <a href="/pwa-studio/technologies/basic-concepts/">Basic concepts</a>
        </li> 
        
        <li role="menuitem">
          <a href="/pwa-studio/pwa-buildpack/">PWA Buildpack</a>
        </li> 
        
        <li role="menuitem">
          <a href="/pwa-studio/peregrine/">Peregrine</a>
        </li> 
        
        <li role="menuitem">
          <a href="/pwa-studio/venia-pwa-concept/">Venia storefront concept</a>
        </li> 
        
        <li role="menuitem">
          <a href="/pwa-studio/technologies/upward/">UPWARD</a>
        </li> 
        
      </ul>
    </div>
  </li>

  

  
  <li class="menuitem ">
      <a href="/pwa-studio/tutorials/">Tutorials</a>
  </li>
  

  
  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span href="#" data-proofer-ignore tabindex="-1">Reference API</span>
    <div class="nav-popup">
      <ul>
        
        <li role="menuitem">
          <a href="/pwa-studio/pwa-buildpack/reference/buildpack-cli/">PWA Buildpack</a>
        </li> 
        
        <li role="menuitem">
          <a href="/pwa-studio/peregrine/reference/item/">Peregrine API</a>
        </li> 
        
        <li role="menuitem">
          <a href="/pwa-studio/venia-ui/reference/components/Button/">Venia UI API</a>
        </li> 
        
      </ul>
    </div>
  </li>

  

  
  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span href="#" data-proofer-ignore tabindex="-1">Integrations</span>
    <div class="nav-popup">
      <ul>
        
        <li role="menuitem">
          <a href="/pwa-studio/pagebuilder/">Page Builder</a>
        </li> 
        
      </ul>
    </div>
  </li>

  

</ul>

    </div>

    <div class="nav-actions">
        
<div class="app-switcher">
  <div class="dropdown">
    <button id="app-switcher-trigger" class="app-switcher-trigger" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" aria-label="Documentation sites"></button>
    <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="app-switcher-trigger" role="menu">
      <div class="app-switcher-content">
      
      <div class="app-switcher-group">
        <h3 class="app-swither-group-title">Developer</h3>
        
        <li role="menuitem"><a class="dropdown-item" href="https://devdocs.magento.com/?itm_source=pwa-devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=Commerce Developer Documentation">Commerce Developer Documentation</a></li>
        
        <li role="menuitem"><a class="dropdown-item" href="http://pwastudio.io/?itm_source=pwa-devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=PWA Studio">PWA Studio</a></li>
        
        <li role="menuitem"><a class="dropdown-item" href="https://omsdocs.magento.com/en/?itm_source=pwa-devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=Order Management">Order Management</a></li>
        
      </div>
      
      <div class="app-switcher-group">
        <h3 class="app-swither-group-title">Merchant</h3>
        
        <li role="menuitem"><a class="dropdown-item" href="https://docs.magento.com/m2/ee/user_guide/?itm_source=pwa-devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=Commerce User Guide">Commerce User Guide</a></li>
        
        <li role="menuitem"><a class="dropdown-item" href="https://omsdocs.magento.com/en/userguides/?itm_source=pwa-devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=Order Management">Order Management</a></li>
        
        <li role="menuitem"><a class="dropdown-item" href="https://docs.magento.com/mbi/?itm_source=pwa-devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=Business Intelligence">Business Intelligence</a></li>
        
        <li role="menuitem"><a class="dropdown-item" href="https://docs.magento.com/marketplace/user_guide/getting-started.html?itm_source=pwa-devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=Marketplace">Marketplace</a></li>
        
      </div>
      
      </div>
    </ul>
  </div>
</div>


        <div class="search-btn">
          <button class="search-trigger search-icon" aria-label="Search"></button>
        </div>
    
        <form class="quick-search" action="/pwa-studio/search/" method="get" novalidate="novalidate">
          <input type="search" name="query" placeholder="Search" />
          <button class="quick-search-close" aria-label="Close search">&times;</button>
        </form>

    </div>

  </div>
</nav><!-- .site-nav -->
<div class="nav-main-fader"></div>

	</header>

	<div class="global-wrapper">
		<div class="message-banner">
If you have any project questions, concerns, or contribution ideas, join our <a href="https://magentocommeng.slack.com/messages/C71HNKYS2"><strong>#pwa</strong></a> Slack channel.
Find out how to create an account by visiting <a href="https://devdocs.magento.com/community/resources/resources.html">Community Resources</a>
</div>


		<div class="main-container">
			<a id="main-content"></a>


<div class="content-container">

	<!-- sidebar -->
<aside class="sidebar">
    <button class="toc-toggler">Table of Contents</button>
    <div class="sidebar-wrapper">

      






<div class="menu-section">
    <div class="toc-entry"><h4 class="guide-title">Getting Started</h4></div>

    <ul class="table-of-contents">
    
        <li >
            
            <a href="/pwa-studio/technologies/overview/" class=" ">Overview</a>
            

            
        </li>
    
        <li >
            
            <a href="/pwa-studio/technologies/tools-libraries/" class=" ">Tools and libraries</a>
            

            
        </li>
    
        <li >
            
            <span>Magento integration</span>
            

            
            <ul>
            
                <li >
                    
                    <a href="/pwa-studio/technologies/magento-compatibility/" class=" ">Magento compatibility</a>
                    
                </li>
            
                <li >
                    
                    <a href="/pwa-studio/technologies/theme-vs-storefront/" class=" ">Magento theme vs PWA storefront</a>
                    
                </li>
            
            </ul>
            
        </li>
    
        <li >
            
            <a href="/pwa-studio/technologies/storefront-architecture/" class=" parent">PWA Storefront architecture</a>
            

            
            <ul>
            
                <li >
                    
                    <a href="/pwa-studio/technologies/storefront-architecture/runtime/" class=" ">Runtime architecture</a>
                    
                </li>
            
                <li >
                    
                    <a href="/pwa-studio/technologies/storefront-architecture/buildtime/" class=" ">Build-time architecture</a>
                    
                </li>
            
            </ul>
            
        </li>
    
        <li >
            
            <a href="/pwa-studio/technologies/basic-concepts/" class=" parent">Basic concepts</a>
            

            
            <ul>
            
                <li >
                    
                    <a href="/pwa-studio/technologies/basic-concepts/app-shell/" class=" ">Application shell</a>
                    
                </li>
            
                <li >
                    
                    <a href="/pwa-studio/technologies/basic-concepts/content-rendering/" class=" ">Content rendering</a>
                    
                </li>
            
                <li >
                    
                    <a href="/pwa-studio/technologies/basic-concepts/css-modules/" class=" ">CSS modules</a>
                    
                </li>
            
                <li >
                    
                    <a href="/pwa-studio/technologies/basic-concepts/graphql/" class=" ">GraphQL</a>
                    
                </li>
            
                <li class="active">
                    
                    <a href="/pwa-studio/technologies/basic-concepts/client-side-caching/" class=" ">Client-side caching</a>
                    
                </li>
            
                <li >
                    
                    <a href="/pwa-studio/technologies/basic-concepts/state-management/" class=" ">State management</a>
                    
                </li>
            
            </ul>
            
        </li>
    
        <li >
            
            <a href="/pwa-studio/pwa-buildpack/" class=" parent">PWA Buildpack</a>
            

            
            <ul>
            
                <li >
                    
                    <a href="/pwa-studio/pwa-buildpack/configuration-management/" class=" ">Configuration management</a>
                    
                </li>
            
                <li >
                    
                    <a href="/pwa-studio/pwa-buildpack/scaffolding/" class=" ">Scaffolding</a>
                    
                </li>
            
                <li >
                    
                    <a href="/pwa-studio/pwa-buildpack/scaffolding/custom-project-templates/" class=" ">Custom project templates</a>
                    
                </li>
            
                <li >
                    
                    <a href="/pwa-studio/pwa-buildpack/troubleshooting/" class=" ">Troubleshooting</a>
                    
                </li>
            
            </ul>
            
        </li>
    
        <li >
            
            <a href="/pwa-studio/peregrine/" class=" parent">Peregrine</a>
            

            
            <ul>
            
                <li >
                    
                    <a href="/pwa-studio/peregrine/talons/" class=" ">Talons</a>
                    
                </li>
            
                <li >
                    
                    <a href="/pwa-studio/peregrine/routing/" class=" ">Routing in PWA Studio</a>
                    
                </li>
            
            </ul>
            
        </li>
    
        <li >
            
            <a href="/pwa-studio/venia-pwa-concept/" class=" parent">Venia storefront concept</a>
            

            
            <ul>
            
                <li >
                    
                    <a href="/pwa-studio/venia-pwa-concept/setup/" class=" ">Storefront setup</a>
                    
                </li>
            
                <li >
                    
                    <a href="/pwa-studio/venia-pwa-concept/install-sample-data/" class=" ">Install Venia sample data</a>
                    
                </li>
            
                <li >
                    
                    <a href="/pwa-studio/venia-pwa-concept/project-structure/" class=" ">Project structure</a>
                    
                </li>
            
                <li >
                    
                    <a href="/pwa-studio/venia-pwa-concept/features/modular-components/" class=" ">Modular components</a>
                    
                </li>
            
            </ul>
            
        </li>
    
        <li >
            
            <a href="/pwa-studio/technologies/upward/" class=" parent">UPWARD</a>
            

            
            <ul>
            
                <li >
                    
                    <a href="/pwa-studio/technologies/upward/reference-implementation/" class=" ">Reference implementation</a>
                    
                </li>
            
            </ul>
            
        </li>
    
        <li >
            
            <a href="/pwa-studio/technologies/versioning/" class=" ">Versioning strategy</a>
            

            
        </li>
    
        <li >
            
            <a href="/pwa-studio/technologies/contribute/" class=" ">Contributing to PWA Studio</a>
            

            
        </li>
    
    </ul>
</div>



    </div>
</aside>
<!-- /sidebar -->


	<section class="content">
		<div class="content-wrap">
			<!-- page-header -->
<section class="page-intro">
	<h1 class="page-heading">Client-side caching</h1>
</section>

			<p>Client-server communication is slow and expensive.
Performance is an important feature for any Progressive Web Application (PWA), so
requests to the server should be minimized.</p>

<p>Offline mode is also a required feature for a PWA.
In offline mode, the application must be able to serve pages that have been recently viewed.</p>

<p>These features are implemented with the help of a client-side cache.
This local cache stores data from resources as they are fetched.
Once a resource has been cached, the service worker may consult the cache on subsequent requests for that resource to boost performance.</p>

<h2 id="service-worker-caching">Service Worker caching</h2>

<p>A <a href="https://developers.google.com/web/ilt/pwa/introduction-to-service-worker">service worker</a> is a JavaScript file that runs in a separate thread from the main execution thread in a web application.
Service workers can intercept network requests and fetch cached data or store results from a network request into the cache.</p>

<h3 id="venia-service-worker">Venia service worker</h3>

<p>Venia’s service worker behavior is defined in the <a href="https://github.com/magento/pwa-studio/blob/master/packages/venia-concept/src/sw.js"><code class="highlighter-rouge">src/sw.js</code></a> file using Google’s <a href="https://developers.google.com/web/tools/workbox/">Workbox</a> library.</p>

<p>You do not need to use Workbox to define service worker behavior, but
Workbox makes this task easier by removing boilerplate code that is always used when working with service workers.</p>

<p>Venia uses the following <a href="https://developers.google.com/web/tools/workbox/modules/workbox-strategies">caching strategies</a> with its service worker:</p>

<h4 id="stale-while-revalidate"><a href="https://developers.google.com/web/fundamentals/instant-and-offline/offline-cookbook/#stale-while-revalidate">Stale-while-revalidate</a></h4>

<p>The stale-while-revalidate strategy tells the service worker to use a cached response if it exists.
A separate network request is made for that resource and the cache is updated for future requests.</p>

<p>This strategy is used when the most up to date version of a resource is not necessary for an application.</p>

<table>
  <thead>
    <tr>
      <th>Route pattern</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">/</code></td>
      <td>The application root</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">/.\\.js$</code></td>
      <td>JavaScript files</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">/\/media\/catalog.*\.(?:png|gif|jpg|jpeg|svg)$/</code></td>
      <td>Catalog image files</td>
    </tr>
  </tbody>
</table>

<h4 id="network-first"><a href="https://developers.google.com/web/fundamentals/instant-and-offline/offline-cookbook/#network-falling-back-to-cache">Network first</a></h4>

<p>The network first strategy tells the service worker to get a resource from the network first.
If a network connection cannot be made, the service worker uses the cache as a fallback.</p>

<p>This strategy is used for data that may change frequently on the server.</p>

<table>
  <thead>
    <tr>
      <th>Route pattern</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">\\.html$</code></td>
      <td>HTML pages</td>
    </tr>
  </tbody>
</table>

<h4 id="cache-first"><a href="https://developers.google.com/web/fundamentals/instant-and-offline/offline-cookbook/#cache-falling-back-to-network">Cache first</a></h4>

<p>The cache first strategy tells the service worker to use the data from the cache.
Unlike the stale-while-revalidate strategy, no network call is made to update the cache.</p>

<p>If a response is not found in the cache, a network call is made to get the resource and cache the response.</p>

<p>This strategy is used for non-critical assets that do not get updated very often.</p>

<table>
  <thead>
    <tr>
      <th>Route pattern</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">images</code></td>
      <td>Image files served from the application</td>
    </tr>
  </tbody>
</table>

<h2 id="caching-in-the-apollo-graphql-client">Caching in the Apollo GraphQL client</h2>

<p>The Venia implementation storefront uses the Apollo GraphQL client to make requests to the Magento GraphQL endpoint.
It also incorporates the default <a href="https://www.apollographql.com/docs/react/advanced/caching"><code class="highlighter-rouge">InMemoryCache</code></a> implementation to add caching abilities to the client.</p>

<p>The cache is persisted between browser sessions in <code class="highlighter-rouge">window.localstorage</code> using the <a href="https://github.com/apollographql/apollo-cache-persist"><code class="highlighter-rouge">apollo-cache-persist</code></a> module.
This lets the Apollo client maintain its cached data even when the user closes the application.</p>

<p>By default, <code class="highlighter-rouge">InMemoryCache</code> uses a cache first strategy for all queries.
This strategy is set using the <code class="highlighter-rouge">fetchPolicy</code> prop on the <code class="highlighter-rouge">Query</code> component.</p>

<p>Caching for Apollo is set up in the <a href="https://github.com/magento/pwa-studio/blob/master/packages/venia-concept/src/drivers/adapter.js"><code class="highlighter-rouge">src/drivers/adapter.js</code></a> file.</p>


			
		</div>
		<!-- /.content-wrap -->

		<div class="page-info">

  

  
  <div class="github-link">
    <a class="improve-page" href="https://github.com/magento/pwa-studio/tree/develop/pwa-devdocs/src/technologies/basic-concepts/client-side-caching/index.md" target="_blank">
      Edit this page on GitHub
    </a>
  </div>
  

  
  <div class="new-issue">
    <a href="https://github.com/magento/pwa-studio/issues/new?title=Feedback on page: /technologies/basic-concepts/client-side-caching/" target="_blank">
      Give us feedback
    </a>
  </div>
  

</div>


	</section>
	<!-- /.content -->

</div> <!-- /.content-container -->


	</div>
	<!-- /.main-container -->
</div>
<!-- /#gl-wrapper -->

<!-- footer-->
<div class="page-footer">
  <div class="container">

    <div class="copyright-links">
      <ul class="nav footer-links">
    <li><a href="http://magento.com/legal/terms/privacy/">Privacy Policy</a></li>
    <li><a href="http://magento.com/legal/terms/">Terms of Service</a></li>
    <li><a href="http://magento.com/legal/licensing/">License/Trademark FAQ</a></li>
    <li><a href="https://magentocommeng.slack.com/messages/C71HNKYS2">#pwa Slack channel</a></li>
  </ul>
    </div>

		<div class="copyright-date">&copy; 2020 Magento. All rights reserved.</div>

  </div>
</div>
<!-- / #footer -->


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="/pwa-studio/assets/js/app.min.js?ver=7"></script>

<script src="/pwa-studio/builds/js/index.bundle.js"></script>

</body>
</html>

